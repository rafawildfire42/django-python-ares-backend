name: ğŸš€ Deploy backend on push

on:
  push:
    branches:
      - main

jobs:
  backend-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest
    env:  # Definindo variÃ¡veis de ambiente para o fluxo de trabalho
      SECRET_KEY: ${{ secrets.SECRET_KEY }}
      DATABASE_URL: ${{ secrets.DATABASE_URL }}
      DEBUG: False
      DJANGO_SETTINGS_MODULE: "aresbackend.settings"
      # Adicione outras variÃ¡veis de ambiente conforme necessÃ¡rio

    steps:
      - name: ğŸšš Get latest code
        uses: actions/checkout@v3

      - name: ğŸŒ Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x' # Especifique a versÃ£o do Python que vocÃª estÃ¡ usando

      - name: ğŸŒ Install Poetry
        run: curl -sSL https://install.python-poetry.org | python3 -

      - name: ğŸŒ Install project dependencies with Poetry
        run: poetry install

      - name: ğŸŒ Build the application
        run: poetry run python manage.py collectstatic --noinput --settings=aresbackend.settings

      - name: ğŸ“‚ Install lftp
        run: sudo apt-get update && sudo apt-get install -y lftp

      - name: ğŸ“‚ Deploy via FTP
        run: |
          lftp -c "open -u ${{ secrets.ftp_user }},${{ secrets.ftp_password }} ${{ secrets.ftp_host }}; set ssl:verify-certificate no; mirror --reverse --verbose --exclude-glob backend ./dist backend"
